angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$rootElement","$window","$timeout",function(a,b,c,d,e){function f(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b}function g(a,b){var c=null;for(var d in a)if(angular.isElement(a[d])&&(c=angular.element(a[d]),c.hasClass(b)))return c;return c}function h(c,h){function j(){m(),k(),l();var a=n(J);a(),x()}function k(){if(!z.legend.display)return F=B,void(G=A);switch(z.legend.position){case"top":case"bottom":F=.75*B,G=A;break;case"left":case"right":F=B,G=.75*A}}function l(){var d=a.get(z.legend.position);h.html(d),b(h.contents())(c);var e=h.find("div");H=g(e,"ac-chart"),I=g(e,"ac-legend"),F-=g(e,"ac-title")[0].clientHeight}function m(){C=c.acData,J=c.acChart,D=C?C.series||[]:[],E=C?C.data||[]:[],c.acConfig&&(angular.extend(z,c.acConfig),z.colors=z.colors.concat(K))}function n(a){var b={pie:s,bar:p,line:q,area:r,point:t};return b[a]}function o(a,b){var c=b.domain();if(z.xAxisMaxTicks&&c.length>z.xAxisMaxTicks){var d=Math.ceil(c.length/z.xAxisMaxTicks);a.tickValues(c.filter(function(a,b){return b%d===0}))}}function p(){var a={top:0,right:20,bottom:30,left:40};G-=a.left+a.right,F-=a.top+a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,G],.1),d=d3.scale.linear().range([F,10]),e=d3.scale.ordinal().rangeRoundBands([0,G],.1),f=[0];E.forEach(function(a){a.nicedata=a.y.map(function(b,c){return f.push(b),{x:a.x,y:b,s:c,tooltip:angular.isArray(a.tooltip)?a.tooltip[c]:a.tooltip}})});var g=d3.max(E.map(function(a){return a.y.length}));c.yMaxData=g,b.domain(E.map(function(a){return a.x}));var h=.2*d3.max(f);d.domain([d3.min(f),d3.max(f)+h]),e.domain(d3.range(g)).rangeRoundBands([0,b.rangeBand()]);var i=d3.svg.axis().scale(b).orient("bottom");o(i,b);var j=d3.svg.axis().scale(d).orient("left").ticks(10).tickFormat(d3.format("s")),k=d3.select(H[0]).append("svg").attr("width",G+a.left+a.right).attr("height",F+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");k.append("g").attr("class","x axis").attr("transform","translate(0,"+F+")").call(i),k.append("g").attr("class","y axis").call(j);var l=k.selectAll(".state").data(E).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+b(a.x)+",0)"}),m=l.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");m.attr("width",e.rangeBand()),m.attr("x",function(a,b){return e(b)}).attr("y",F).style("fill",function(a){return y(a.s)}).attr("height",0).transition().ease("cubic-in-out").duration(z.isAnimate?1e3:0).attr("y",function(a){return d(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(d(a.y)-d(0))}),m.on("mouseover",function(a){u({value:a.y,series:D[a.s],index:a.x},d3.event),z.mouseover(a,d3.event),c.$apply()}).on("mouseleave",function(a){v(),z.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(){w(d3.event)}).on("click",function(a){z.click.call(a,d3.event),c.$apply()}),z.labels&&l.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return e(b)}).attr("y",function(a){return F-Math.abs(d(a.y)-d(0))}).text(function(a){return a.y}),k.append("line").attr("x1",G).attr("y1",d(0)).attr("y2",d(0)).style("stroke","silver")}function q(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};G-=b.left+b.right,F-=b.top+b.bottom;var d=d3.scale.ordinal().domain(E.map(function(a){return a.x})).rangeRoundBands([0,G]),e=d3.scale.linear().range([F,10]),f=d3.svg.axis().scale(d).orient("bottom");o(f,d);var g=d3.svg.axis().scale(e).orient("left").ticks(5).tickFormat(d3.format("s")),h=d3.svg.line().interpolate("cardinal").x(function(b){return a(b.x)}).y(function(a){return e(a.y)}),i=[0],j=[];E.forEach(function(a){a.y.map(function(a){i.push(a)})});var k=d3.max(E.map(function(a){return a.y.length}));c.yMaxData=k,D.slice(0,k).forEach(function(a,b){var c={};c.series=a,c.values=E.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:E[b].x,y:0}}),j.push(c)});var l=d3.select(H[0]).append("svg").attr("width",G+b.left+b.right).attr("height",F+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),m=.2*d3.max(i);e.domain([d3.min(i),d3.max(i)+m]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+F+")").call(f),l.append("g").attr("class","y axis").call(g);var n=l.selectAll(".points").data(j).enter().append("g");if(path=n.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return y(b)}).attr("d",function(a){return h(a.values)}).attr("stroke-width","2").attr("fill","none"),j.length>0){var p=j[j.length-1].values;if(p.length>0){var q=path.node().getTotalLength()+a(p[p.length-1].x);path.attr("stroke-dasharray",q+" "+q).attr("stroke-dashoffset",q).transition().duration(z.isAnimate?1500:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return h(a.values)})}}return angular.forEach(j,function(b){var d=l.selectAll(".circle").data(b.values).enter();d.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return e(a.y)}).attr("r",3).style("fill",y(j.indexOf(b))).style("stroke",y(j.indexOf(b))).on("mouseover",function(a){return function(b){u({index:b.x,value:b.y,series:a},d3.event),z.mouseover(b,d3.event),c.$apply()}}(b.series)).on("mouseleave",function(a){v(),z.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(){w(d3.event)}).on("click",function(a){z.click(a,d3.event),c.$apply()}),z.labels&&d.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return e(a.y)}).text(function(a){return a.y})}),"lineEnd"===z.lineLegend&&n.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(b){return"translate("+a(b.value.x)+","+e(b.value.y)+")"}).attr("x",3).text(function(a){return a.name}),j}function r(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};G-=b.left+b.right,F-=b.top+b.bottom;var d=d3.scale.ordinal().domain(E.map(function(a){return a.x})).rangeRoundBands([0,G]),e=d3.scale.linear().range([F,10]),f=d3.svg.axis().scale(d).orient("bottom");o(f,d);var g=d3.svg.axis().scale(e).orient("left").ticks(5).tickFormat(d3.format("s"));d3.svg.line().interpolate("cardinal").x(function(b){return a(b.x)}).y(function(a){return e(a.y)});var h=[0],i=[];E.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(E.map(function(a){return a.y.length}));c.yMaxData=j,D.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=E.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:E[b].x,y:0}}),i.push(c)});var k=d3.select(H[0]).append("svg").attr("width",G+b.left+b.right).attr("height",F+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),l=.2*d3.max(h);e.domain([d3.min(h),d3.max(h)+l]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+F+")").call(f),k.append("g").attr("class","y axis").call(g);var m=k.selectAll(".points").data(i).enter().append("g"),n=d3.svg.area().interpolate("basis").x(function(b){return a(b.x)}).y0(function(){return e(0)}).y1(function(a){return e(0+a.y)});m.append("path").attr("class","area").attr("d",function(a){return n(a.values)}).style("fill",function(a,b){return y(b)}).style("opacity","0.7")}function s(){function a(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return g(b(a))}}var b=Math.min(G,F)/2,d=d3.select(H[0]).append("svg").attr("width",G).attr("height",F).append("g").attr("transform","translate("+G/2+","+F/2+")"),e=0;if(z.innerRadius){var f=z.innerRadius;f="string"==typeof f&&f.indexOf("%")>0?.01*b*parseFloat(f):Number(f),f>=0&&(e=f)}c.yMaxData=E.length;var g=d3.svg.arc().outerRadius(b-10).innerRadius(e);d3.svg.arc().outerRadius(b+5).innerRadius(0);var h=d3.layout.pie().sort(null).value(function(a){return a.y[0]}),i=d.selectAll(".arc").data(h(E)).enter().append("g"),j=!1;i.append("path").style("fill",function(a,b){return y(b)}).transition().ease("linear").duration(z.isAnimate?500:0).attrTween("d",a).attr("class","arc").each("end",function(){j||(j=!0,i.on("mouseover",function(a){u({value:a.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),z.mouseover(a,d3.event),c.$apply()}).on("mouseleave",function(a){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),v(),z.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(){w(d3.event)}).on("click",function(a){z.click(a,d3.event),c.$apply()}))}),z.labels&&i.append("text").attr("transform",function(a){return"translate("+g.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})}function t(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};G-=b.left-b.right,F-=b.top-b.bottom;var d=d3.scale.ordinal().domain(E.map(function(a){return a.x})).rangeRoundBands([0,G]),e=d3.scale.linear().range([F,10]),f=d3.svg.axis().scale(d).orient("bottom");o(f,d);var g=d3.svg.axis().scale(e).orient("left").ticks(5).tickFormat(d3.format("s")),h=[0],i=[];E.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(E.map(function(a){return a.y.length}));c.yMaxPoints=j,D.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=E.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:E[b].x,y:0}}),i.push(c)});var k=d3.select(H[0]).append("svg").attr("width",G+b.left+b.right).attr("height",F+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),l=.2*d3.max(h);e.domain([d3.min(h),d3.max(h)+l]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+F+")").call(f),k.append("g").attr("class","y axis").call(g),k.selectAll(".points").data(i).enter().append("g"),angular.forEach(i,function(b){var d=k.selectAll(".circle").data(b.values).enter();d.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return e(a.y)}).attr("r",3).style("fill",y(i.indexOf(b))).style("stroke",y(i.indexOf(b))).on("mouseover",function(a){return function(b){u({index:b.x,value:b.y,series:a},d3.event),z.mouseover(b,d3.event),c.$apply()}}(b.series)).on("mouseleave",function(a){v(),z.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(){w(d3.event)}).on("click",function(a){z.click(a,d3.event),c.$apply()}),z.labels&&d.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return e(a.y)}).text(function(a){return a.y})})}function u(a,b){if(z.tooltips){a="function"==typeof z.tooltips?z.tooltips(a):a.value;var d=angular.element('<p class="ac-tooltip" style="'+i+'"></p>').html(a).css({left:b.pageX+20+"px",top:b.pageY-30+"px"});angular.element(document.body).append(d),c.$tooltip=d}}function v(){c.$tooltip.remove()}function w(a){c.$tooltip.css({left:a.pageX+20+"px",top:a.pageY-30+"px"})}function x(){c.legends=[],"pie"==J&&angular.forEach(E,function(a,b){c.legends.push({color:z.colors[b],title:a.x})}),("bar"==J||"area"==J||"point"==J||"line"==J&&"traditional"===z.lineLegend)&&angular.forEach(D,function(a,b){c.legends.push({color:z.colors[b],title:a})})}function y(a){if(a<z.colors.length)return z.colors[a];var b=f();return z.colors.push(b),b}var z={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left"},colors:["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"],innerRadius:0,lineLegend:"lineEnd",isAnimate:!0},A=h[0].clientWidth,B=h[0].clientHeight;if(0===B||0===A)throw new Error("Please set height and width for the chart element");var C,D,E,F,G,H,I,J,K=z.colors;if(0===B||0===A)throw new Error("Please set height and width for the chart element");var L=angular.element(d),M=null;L.bind("resize",function(){M&&e.cancel(M),M=e(function(){A=h[0].clientWidth,B=h[0].clientHeight,j()},100)}),c.getWindowDimensions=function(){return{h:L[0].clientHeight,w:L[0].clientWidth}},c.$watch("acChart",function(){j()},!0),c.$watch("acData",function(){j()},!0),c.$watch("acConfig",function(){j()},!0)}var i=["display:block;","position:absolute;","border:1px solid #333;","background-color:#161616;","border-radius:5px;","padding:5px;","color:#fff;"].join("");return{restrict:"EA",link:h,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),angular.module("angularChartsTemplates",["left","right"]),angular.module("left",[]).run(["$templateCache",function(a){a.put("left","\n<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{acConfig.title}}</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{acConfig.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends\">\n		<td><div ng-attr-style='background:{{l.color}}; height:15px;width:15px;'></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>\n<div class='ac-chart' style='float:left; width:75%;'>\n</div>")}]),angular.module("right",[]).run(["$templateCache",function(a){a.put("right","<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{acConfig.title}}</div>\n<div class='ac-chart' style='float:left;width:75%;'>\n</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{acConfig.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends | limitTo:yMaxData\">\n		<td><div ng-attr-style='background:{{l.color}}; height:15px;width:15px;'></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>")}]);